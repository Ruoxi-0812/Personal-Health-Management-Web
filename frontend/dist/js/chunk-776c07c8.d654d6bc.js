(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-776c07c8"],{"0be9":function(t,e,a){"use strict";a("a96f")},"1a6d":function(t,e,a){"use strict";a("5795")},"1ac8":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-container"},[e("div",{staticClass:"menus-container",staticStyle:{position:"sticky",top:"0","z-index":"1000","background-color":"rgb(255, 255, 255)"}},[e("UserMenu",{attrs:{menus:t.routers,userInfo:t.userInfo},on:{eventListener:t.eventListener}})],1),e("div",{staticClass:"content-container"},[e("router-view",{staticClass:"route-container"})],1),e("el-dialog",{attrs:{"show-close":!1,visible:t.dialogOperaion,width:"30%"},on:{"update:visible":function(e){t.dialogOperaion=e}}},[e("div",{staticStyle:{padding:"25px 0 0 20px"},attrs:{slot:"title"},slot:"title"},[e("span",{staticStyle:{"font-size":"18px","font-weight":"800"}},[t._v("Personal Center")])]),e("el-row",{staticStyle:{padding:"10px 20px 20px 20px"}},[e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0","margin-bottom":"10px"}},[e("span",{staticClass:"modelName"},[t._v("*Avatar")])]),e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/personal-heath/v1.0/file/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[t.data.url?e("img",{staticClass:"avatar",attrs:{src:t.data.url}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0"}},[e("span",{staticClass:"modelName"},[t._v("*Username")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.name,expression:"data.name"}],staticClass:"modelInput",attrs:{type:"text",placeholder:"Username"},domProps:{value:t.data.name},on:{input:function(e){e.target.composing||t.$set(t.data,"name",e.target.value)}}})]),e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0"}},[e("span",{staticClass:"modelName"},[t._v("*Email")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.email,expression:"data.email"}],staticClass:"modelInput",attrs:{type:"text",placeholder:"Email"},domProps:{value:t.data.email},on:{input:function(e){e.target.composing||t.$set(t.data,"email",e.target.value)}}})])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"customer",staticStyle:{"background-color":"rgb(241, 241, 241)",border:"none"},attrs:{size:"small"},on:{click:function(e){t.dialogOperaion=!1}}},[t._v("Cancel")]),e("el-button",{staticClass:"customer",staticStyle:{"background-color":"#15559a",border:"none"},attrs:{size:"small",type:"info"},on:{click:t.updateUserInfo}},[t._v("Update")])],1)],1),e("el-dialog",{attrs:{"show-close":!1,visible:t.dialogRetPwdOperaion,width:"26%"},on:{"update:visible":function(e){t.dialogRetPwdOperaion=e}}},[e("div",{staticStyle:{padding:"25px 0 0 20px"},attrs:{slot:"title"},slot:"title"},[e("span",{staticStyle:{"font-size":"18px","font-weight":"800"}},[t._v("Reset Password")])]),e("el-row",{staticStyle:{padding:"10px 20px 20px 20px"}},[e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0","margin-bottom":"10px"}},[e("span",{staticClass:"modelName"},[t._v("*Old Password")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.pwdEntity.oldPwd,expression:"pwdEntity.oldPwd"}],staticClass:"modelInput",attrs:{type:"password",placeholder:"Old Password"},domProps:{value:t.pwdEntity.oldPwd},on:{input:function(e){e.target.composing||t.$set(t.pwdEntity,"oldPwd",e.target.value)}}})]),e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0","margin-bottom":"10px"}},[e("span",{staticClass:"modelName"},[t._v("*New Password")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.pwdEntity.newPwd,expression:"pwdEntity.newPwd"}],staticClass:"modelInput",attrs:{type:"password",placeholder:"New Password"},domProps:{value:t.pwdEntity.newPwd},on:{input:function(e){e.target.composing||t.$set(t.pwdEntity,"newPwd",e.target.value)}}})]),e("el-row",[e("p",{staticStyle:{"font-size":"12px",padding:"3px 0","margin-bottom":"10px"}},[e("span",{staticClass:"modelName"},[t._v("*Confirm Password")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.pwdEntity.againPwd,expression:"pwdEntity.againPwd"}],staticClass:"modelInput",attrs:{type:"password",placeholder:"Confirm Password"},domProps:{value:t.pwdEntity.againPwd},on:{input:function(e){e.target.composing||t.$set(t.pwdEntity,"againPwd",e.target.value)}}})])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"customer",staticStyle:{"background-color":"rgb(241, 241, 241)",border:"none"},attrs:{size:"small"},on:{click:function(e){t.dialogRetPwdOperaion=!1}}},[t._v("Cancel")]),e("el-button",{staticClass:"customer",staticStyle:{"background-color":"#15559a",border:"none"},attrs:{size:"small",type:"info"},on:{click:t.updateUserPwd}},[t._v("Update")])],1)],1)],1)},o=[],i=a("5d2d"),n=a("a18c"),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nav"},[e("Logo",{attrs:{sysName:"Healthy Living"}}),t._l(t.menus,(function(a,s){return a.isHidden?t._e():e("div",{key:s,staticClass:"menu-item",style:{color:t.selectedIndex===s?"#1c1c1c":"rgb(102 102 102)"},on:{click:function(e){return t.menuClick(""+a.path,s)}}},[e("span",[e("i",{class:a.icon}),e("span",[t._v("Â  "+t._s(a.name))])])])})),e("div",{staticClass:"search"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.filterText,expression:"filterText"}],attrs:{placeholder:"Search information"},domProps:{value:t.filterText},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)},input:function(e){e.target.composing||(t.filterText=e.target.value)}}}),e("span",{on:{click:t.search}},[t._v("Search Now")])]),e("div",{staticClass:"record"},[e("span",{staticStyle:{margin:"14px 10px"},on:{click:t.healthDataRecord}},[e("i",{staticClass:"el-icon-connection"}),t._v(" Health Records ")])]),e("div",{staticClass:"messsage"},[0!==t.noReadMsg?e("el-badge",{attrs:{value:t.noReadMsg}},[e("span",{staticClass:"message-span",on:{click:t.messageCenter}},[e("i",{staticClass:"el-icon-chat-dot-round"})])]):e("span",{staticClass:"message-span",on:{click:t.messageCenter}},[e("i",{staticClass:"el-icon-chat-dot-round"})])],1),e("div",[e("el-dropdown",{staticClass:"user-dropdown"},[e("span",{staticClass:"el-dropdown-link",staticStyle:{display:"flex","align-items":"center"}},[e("el-avatar",{staticStyle:{"margin-top":"0"},attrs:{size:25,src:t.userInfo.url}}),e("span",{staticClass:"userName",staticStyle:{"margin-left":"5px","font-size":"14px",width:"100px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[t._v(t._s(t.userInfo.name))]),e("i",{staticClass:"el-icon-arrow-down el-icon--right",staticStyle:{"margin-left":"5px"}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{icon:"el-icon-user"},nativeOn:{click:function(e){return t.userCenterPanel.apply(null,arguments)}}},[t._v("Personal Center")]),e("el-dropdown-item",{attrs:{icon:"el-icon-warning-outline"},nativeOn:{click:function(e){return t.resetPwd.apply(null,arguments)}}},[t._v("Change Password")]),e("el-dropdown-item",{attrs:{icon:"el-icon-back"},nativeOn:{click:function(e){return t.loginOut.apply(null,arguments)}}},[t._v("Log out")])],1)],1)],1)],2)},l=[],d=a("2241"),c={name:"UserMenu",components:{Logo:d["a"]},data(){return{selectedIndex:0,messagePath:"/message",loginPath:"/login",sysName:"Healthy Living",defaultPath:"/news-record",filterText:"",noReadMsg:0}},props:{menus:{type:Array,required:!0},userInfo:{type:Object,required:!0}},mounted(){this.pathToDo(this.defaultPath),this.loadMsgCount()},methods:{search(){"/search-detail"!==this.$route.path?(sessionStorage.setItem("keyWord",this.filterText),this.$emit("eventListener","search-detail")):sessionStorage.setItem("keyWord",this.filterText)},userCenterPanel(){this.$emit("eventListener","center")},resetPwd(){this.$emit("eventListener","resetPwd")},loginOut(){this.$emit("eventListener","loginOut")},dietRecord(){this.$emit("eventListener","dietRecord")},healthDataRecord(){this.$emit("eventListener","healthDataRecord")},loginOut(){this.$emit("eventListener","loginOut")},async loadMsgCount(){const t=sessionStorage.getItem("userInfo"),e=JSON.parse(t),a={userId:e.id,isRead:!1},s=await this.$axios.post("/message/query",a),{data:o}=s;200===o.code&&(this.noReadMsg=o.data.length)},pathToDo(t){this.$route.path!==t&&this.$router.push(t)},menuClick(t,e){this.selectedIndex=e,this.pathToDo(t)},messageCenter(){this.selectedIndex=null,this.pathToDo(this.messagePath)},async out(){const t=await this.$swalConfirm({title:"Logout or not",text:"After logging out, you will have to log in again to use the system",icon:"warning"});t?(this.$swal.fire({title:"Log out",text:"You have successfully logged out.",icon:"success",showConfirmButton:!1,timer:1300}),setTimeout(()=>{Object(i["a"])(),this.$router.push("/loginPath")},1300)):console.log("Canceled the logout operation")}}},u=c,p=(a("bd2e"),a("2877")),h=Object(p["a"])(u,r,l,!1,null,"575f20b2",null),m=h.exports,g={name:"UserMain",components:{UserMenu:m},data(){return{userInfo:{},data:{},pwdEntity:{oldPwd:"",newPwd:"",againPwd:""},dialogOperaion:!1,dialogRetPwdOperaion:!1,foodList:[],routers:[],isCheckFood:[],isCheckHealthModelConfig:[],healthModelConfig:[],selecedFoodIndex:0,selecedHealthModelIndex:0,dietDialog:!1,healthModelConfigDialog:!1}},created(){this.tokenCheckLoad()},methods:{healthModelChange(){const t=this.healthModelConfig[this.selecedHealthModelIndex-2],e=this.isCheckHealthModelConfig.some(e=>e.id===t.id);e?console.log("Indicator already added"):this.isCheckHealthModelConfig.unshift(t)},updateUserPwd(){this.resetPwd()},async updateUserInfo(){try{const t={userAvatar:this.data.url,userName:this.data.name,userEmail:this.data.email},e=await this.$axios.put("/user/update",t),{data:a}=e;200===a.code&&(this.dialogOperaion=!1,this.tokenCheckLoad(),this.$swal.fire({title:"Update Personal Info",text:a.msg,icon:"success",showConfirmButton:!1,timer:1e3}))}catch(t){this.dialogOperaion=!1,this.$swal.fire({title:"Error updating personal information",text:t,icon:"error",showConfirmButton:!1,timer:2e3}),console.error("Error updating personal information: "+t)}},async resetPwd(){try{const{oldPwd:t,newPwd:e,againPwd:a}=this.pwdEntity;if(!t||!e||!a)return void this.$message("No field can be empty");if(e!==a)return void this.$message("Passwords do not match");const s={oldPwd:this.$md5(this.$md5(t)),newPwd:this.$md5(this.$md5(e))},o=await this.$axios.put("/user/updatePwd",s),{data:n}=o;200===n.code?(this.dialogRetPwdOperaion=!1,this.$swal.fire({title:"Password Updated",text:n.msg,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{Object(i["a"])(),this.$router.push("/login")},1200)):this.$message.error(n.msg)}catch(t){this.dialogOperaion=!1,this.$error(data.msg),console.error("Error updating password: "+t)}},handleAvatarSuccess(t,e){200===t.code?(this.$message.success("Avatar uploaded successfully"),this.data.url=t.data):this.$message.error("Avatar upload error")},eventListener(t){"center"!==t?"resetPwd"!==t?"search-detail"!==t?"loginOut"!==t?"healthDataRecord"!==t||this.$router.push("/record"):this.loginOutOperation():this.$router.push("/search-detail"):this.dialogRetPwdOperaion=!0:this.dialogOperaion=!this.dialogOperaion},async loginOutOperation(){const t=await this.$swalConfirm({title:"Log Out",text:"After logging out, you will need to log in again to use the system features!",icon:"warning"});t&&(Object(i["a"])(),this.$router.push("/login"))},async tokenCheckLoad(){try{const t=await this.$axios.get("user/auth");if(400===t.data.code)return Object(i["a"])(),this.$message.error(t.data.msg),void this.$router.push("/login");const{id:e,userAvatar:a,userName:s,userRole:o,userEmail:r}=t.data.data;sessionStorage.setItem("userInfo",JSON.stringify(t.data.data)),this.userInfo={url:a,name:s,role:o,email:r},this.data={...this.userInfo};const l=1===o?"admin":"user",d=n["a"].options.routes.find(t=>t.path.startsWith("/"+l));d?this.routers=d.children:console.error("Failed to find corresponding route for the role")}catch(t){console.error("Error during token validation:",t)}}}},w=g,f=(a("0be9"),Object(p["a"])(w,s,o,!1,null,"f6d38574",null));e["default"]=f.exports},2241:function(t,e,a){"use strict";var s=function(){var t=this,e=t._self._c;return e("span",{staticClass:"logo"},[e("el-image",{staticStyle:{width:"25px",height:"25px"},attrs:{src:"/logo.png",fit:"fill"}}),t.flag?t._e():e("div",[e("span",{style:{color:t.bag,display:"block"}},[t._v(t._s(t.sysName))])])],1)},o=[],i={name:"Logo",data(){return{}},props:{flag:{type:Boolean,required:!1},sysName:{type:String,required:!1},bag:{type:String,default:"#1c1c1c"}},created(){},methods:{}},n=i,r=(a("1a6d"),a("2877")),l=Object(r["a"])(n,s,o,!1,null,"1dc3616d",null);e["a"]=l.exports},5795:function(t,e,a){},"8c68":function(t,e,a){},a96f:function(t,e,a){},bd2e:function(t,e,a){"use strict";a("8c68")}}]);
//# sourceMappingURL=chunk-776c07c8.d654d6bc.js.map